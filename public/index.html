<!DOCTYPE html>
<html lang="nl">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title>Clippy Clipboard Sync</title>
    <!-- Roboto font & Material Icons -->
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700&display=swap" />
    <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons" />
    <!-- MUI, React, Babel -->
    <script src="https://unpkg.com/react@18/umd/react.development.js" crossorigin></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js" crossorigin></script>
    <script src="https://unpkg.com/@mui/material@5.15.0/umd/material-ui.development.js" crossorigin></script>
    <script src="https://unpkg.com/@emotion/react@11.11.1/dist/emotion-react.umd.min.js" crossorigin></script>
    <script src="https://unpkg.com/@emotion/styled@11.11.0/dist/emotion-styled.umd.min.js" crossorigin></script>
    <script src="https://unpkg.com/babel-standalone@6/babel.min.js"></script>
    <style>
      body {
        margin: 0;
        background: #f5f5f5;
      }
      #root {
        min-height: 100vh;
        display: flex;
        align-items: center;
        justify-content: center;
      }
    </style>
  </head>
  <body>
    <div id="root"></div>
    <script type="text/babel">
      const {
        Button,
        Container,
        CssBaseline,
        Box,
        Paper,
        Typography,
        Snackbar,
        Alert,
        CircularProgress,
        Icon,
        IconButton,
        Tooltip,
      } = MaterialUI;

      function App() {
        const [content, setContent] = React.useState("");
        const [loading, setLoading] = React.useState(false);
        const [snackbar, setSnackbar] = React.useState({ open: false, message: "", severity: "success" });
        const [fetching, setFetching] = React.useState(true);

        // Copy-knop handler
        const handleCopy = async () => {
          try {
            await navigator.clipboard.writeText(content);
            setSnackbar({ open: true, message: "Copied to clipboard!", severity: "success" });
          } catch (e) {
            setSnackbar({ open: true, message: "Copy failed", severity: "error" });
          }
        };

        // Polling: elke 2s ophalen
        React.useEffect(() => {
          let active = true;
          const fetchClipboard = () => {
            fetch("/api/clipboard")
              .then(res => res.json())
              .then(data => {
                if (active) setContent(data.content || "");
                setFetching(false);
              })
              .catch(() => {
                setSnackbar({ open: true, message: "Fout bij ophalen clipboard", severity: "error" });
                setFetching(false);
              });
          };
          fetchClipboard();
          const interval = setInterval(fetchClipboard, 2000);
          return () => {
            active = false;
            clearInterval(interval);
          };
        }, []);

        // Paste-knop handler
        const handlePaste = async () => {
          setLoading(true);
          try {
            const text = await navigator.clipboard.readText();
            setContent(text);
            const res = await fetch("/api/clipboard", {
              method: "POST",
              headers: { "Content-Type": "application/json" },
              body: JSON.stringify({ content: text }),
            });
            if (!res.ok) throw new Error("Serverfout");
            setSnackbar({ open: true, message: "Clipboard gesynchroniseerd!", severity: "success" });
          } catch (e) {
            setSnackbar({ open: true, message: "Clipboard lezen of sync mislukt", severity: "error" });
          } finally {
            setLoading(false);
          }
        };

        return (
          <React.Fragment>
            <CssBaseline />
            <Container maxWidth="sm" sx={{ mt: 8 }}>
              <Box display="flex" flexDirection="column" alignItems="center" gap={3}>
                <Button
                  variant="contained"
                  size="large"
                  startIcon={<Icon>content_paste</Icon>}
                  onClick={handlePaste}
                  disabled={loading}
                  sx={{ fontSize: 24, py: 2, px: 4 }}
                >
                  PASTE
                </Button>
                <Box sx={{ position: "relative", width: "100%" }}>
                  <Paper
                    elevation={3}
                    sx={{
                      width: "100%",
                      minHeight: 120,
                      p: 3,
                      bgcolor: "#fff",
                      whiteSpace: "pre-wrap",
                      wordBreak: "break-word",
                      fontSize: 18,
                      position: "relative",
                    }}
                  >
                    <Box sx={{ position: "absolute", top: 8, right: 8 }}>
                      <Tooltip title="Copy to clipboard">
                        <span>
<Button
  variant="contained"
  color="primary"
  size="small"
  startIcon={<Icon>content_copy</Icon>}
  onClick={handleCopy}
  disabled={!content}
  aria-label="copy"
  sx={{ fontSize: 12, py: 1, px: 2 }}
>
  COPY
</Button>
                        </span>
                      </Tooltip>
                    </Box>
                    {fetching ? (
                      <Box display="flex" justifyContent="center"><CircularProgress size={32} /></Box>
                    ) : content ? (
                      content
                    ) : (
                      <Typography color="text.secondary" align="center">
                        (Nog geen clipboard-inhoud)
                      </Typography>
                    )}
                  </Paper>
                </Box>
              </Box>
            </Container>
            <Snackbar
              open={snackbar.open}
              autoHideDuration={3000}
              onClose={() => setSnackbar(s => ({ ...s, open: false }))}
              anchorOrigin={{ vertical: "bottom", horizontal: "center" }}
            >
              <Alert
                onClose={() => setSnackbar(s => ({ ...s, open: false }))}
                severity={snackbar.severity}
                sx={{ width: "100%" }}
              >
                {snackbar.message}
              </Alert>
            </Snackbar>
          </React.Fragment>
        );
      }

      ReactDOM.createRoot(document.getElementById("root")).render(<App />);
    </script>
  </body>
</html>
